name: Docker image runner

on:
  push:
    branches: [master]

jobs:
  build:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v2

      - name: Create env file
        uses: SpicyPizza/create-envfile@v1.3
        with:
          envkey_DEBUG: false
          NODE_ENV: 'production'
          TOKEN: ${{ secrets.TOKEN }}
          LAVA_HOST: 'lavalink'
          LAVA_PASS: 'youshallnotpass'
          SPOTIFY_CLIENT_ID: ${{ secrets.SPOTIFY_CLIENT_ID }}
          SPOTIFY_CLIENT_SECRET: ${{ secrets.SPOTIFY_CLIENT_SECRET }}
          directory: .
          file_name: .env
          fail_on_empty: false

      - name: Rebuild Image and start container
        run: sudo docker-compose up -d --build
